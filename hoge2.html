<html>
<head>
<style type="text/css">
	body { font-size: 14px; }
	h2 { background-color: lightgray; padding: 10px; }
	code { color: red; }
</style>
</head>
<body>
<pre>
<h2>こんな検証やってみた</h2>
<code>
:::comment:::
MySQLのデータ保存先のディスク容量を拡張した場合、MySQLは勝手に認識して、より多くのデータを
保存することができるかな？INNODBはたまに変な挙動するので、ちょい不安。バグも多いしね。
ちょい検証してみるか。
</code>

<h2>OS環境</h2>
root# cat /etc/redhat-release
<code>AlmaLinux release 8.8 </code>(Sapphire Caracal)
<code>
:::comment:::
AlmaLinux（アルマリナックス）とは、オープンソースソフトウェアのエンタープライズLinuxのディストリビューション。
CentOSの代替版を目指して開発され、RHELとの親和性が高くタダで使えるお手軽OS。
</code>

<h2>ディスク環境</h2>
root# fdisk -l
ディスク /dev/sda: 20 GiB, 21474836480 バイト, 41943040 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト
ディスクラベルのタイプ: dos
ディスク識別子: 0x0749b515

デバイス   起動 開始位置 終了位置   セクタ サイズ Id タイプ
<code>/dev/sda1</code>  *        2048  2099199  2097152     1G 83 Linux
<code>/dev/sda2</code>        2099200 39864319 37765120    18G 8e Linux LVM
<code>/dev/sda3</code>       39864320 40896511  1032192   504M 8e Linux LVM
<code>
:::commmemnt:::
ディスク構成は、sda1・sda2・sda3の３本構成。
</code>

ディスク /dev/mapper/almalinux_dbserver-root: 16 GiB, 17179869184 バイト, 33554432 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

ディスク /dev/mapper/almalinux_dbserver-swap: 2 GiB, 2147483648 バイト, 4194304 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

ディスク /dev/mapper/almalinux_app-APP: 500 MiB, 524288000 バイト, 1024000 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

root# pvs
  PV         VG                 Fmt  Attr PSize   PFree
  /dev/sda2  almalinux_dbserver lvm2 a--   18.00g 4.00m
  <code>/dev/sda3</code>  almalinux_app      lvm2 a--  500.00m    0

root# vgs
  VG                 #PV #LV #SN Attr   VSize   VFree
  <code>almalinux_app</code>        1   1   0 wz--n- 500.00m    0
  almalinux_dbserver   1   2   0 wz--n-  18.00g 4.00m

root# lvs
  LV   VG                 Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  <code>APP</code>  almalinux_app      -wi-ao---- 500.00m
  root almalinux_dbserver -wi-ao----  16.00g
  swap almalinux_dbserver -wi-ao----   2.00g

root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  1.9G   15G   12% /
/dev/sda1                            1014M  237M  778M   24% /boot
<code>/dev/mapper/almalinux_app-APP         495M   29M  466M    6% /APP</code>
tmpfs                                 198M     1  198M    0% /run/user/0
<code>
:::comment:::
sda3に500MB（実容量は495MB）を/APPに割り当て、MySQLのデータ保存先とする。
</code>


<h2>MySQLのインストール</h2>
root# <code>dnf -y install mysql-server mysql</code>
<code>
:::comment:::
準備が面倒くさいので、お手軽にパッケージ版をインストール。バージョンは8.0.32みたい。
</code>

メタデータの期限切れの最終確認: 0:08:55 前の 2023年06月11日 09時32分37秒 に実施しました。
依存関係が解決しました。
========================================================================================================================================================
 パッケージ                                 アーキテクチャー     バージョン                                               リポジトリー            サイズ
========================================================================================================================================================
インストール:
 mysql                                      x86_64               8.0.32-1.module_el8.8.0+3567+56a616e4                    appstream                15 M
 mysql-server                               x86_64               8.0.32-1.module_el8.8.0+3567+56a616e4                    appstream                32 M
依存関係のインストール:
 checkpolicy                                x86_64               2.9-1.el8                                                baseos                  347 k
 libicu                                     x86_64               60.3-2.el8_1                                             baseos                  8.8 M
 mariadb-connector-c-config                 noarch               3.1.11-2.el8_3                                           appstream                14 k
 mecab                                      x86_64               0.996-2.module_el8.6.0+3340+d764b636                     appstream               392 k
 mysql-common                               x86_64               8.0.32-1.module_el8.8.0+3567+56a616e4                    appstream               136 k
 mysql-errmsg                               x86_64               8.0.32-1.module_el8.8.0+3567+56a616e4                    appstream               628 k
 perl-Carp                                  noarch               1.42-396.el8                                             baseos                   30 k
 perl-Data-Dumper                           x86_64               2.167-399.el8                                            baseos                   58 k
 perl-Digest                                noarch               1.17-395.el8                                             appstream                27 k
 perl-Digest-MD5                            x86_64               2.55-396.el8                                             appstream                37 k
 perl-Encode                                x86_64               4:2.97-3.el8                                             baseos                  1.5 M
 perl-Errno                                 x86_64               1.28-422.el8.0.1                                         baseos                   75 k
 perl-Exporter                              noarch               5.72-396.el8                                             baseos                   34 k
 perl-File-Path                             noarch               2.15-2.el8                                               baseos                   38 k
 perl-File-Temp                             noarch               0.230.600-1.el8                                          baseos                   62 k
 perl-Getopt-Long                           noarch               1:2.50-4.el8                                             baseos                   63 k
 perl-HTTP-Tiny                             noarch               0.074-1.el8                                              baseos                   58 k
 perl-IO                                    x86_64               1.38-422.el8.0.1                                         baseos                  141 k
 perl-MIME-Base64                           x86_64               3.15-396.el8                                             baseos                   30 k
 perl-Net-SSLeay                            x86_64               1.88-2.module_el8.6.0+2811+fe6c84b0                      appstream               378 k
 perl-PathTools                             x86_64               3.74-1.el8                                               baseos                   90 k
 perl-Pod-Escapes                           noarch               1:1.07-395.el8                                           baseos                   20 k
 perl-Pod-Perldoc                           noarch               3.28-396.el8                                             baseos                   86 k
 perl-Pod-Simple                            noarch               1:3.35-395.el8                                           baseos                  213 k
 perl-Pod-Usage                             noarch               4:1.69-395.el8                                           baseos                   34 k
 perl-Scalar-List-Utils                     x86_64               3:1.49-2.el8                                             baseos                   68 k
 perl-Socket                                x86_64               4:2.027-3.el8                                            baseos                   59 k
 perl-Storable                              x86_64               1:3.11-3.el8                                             baseos                   98 k
 perl-Term-ANSIColor                        noarch               4.06-396.el8                                             baseos                   46 k
 perl-Term-Cap                              noarch               1.17-395.el8                                             baseos                   23 k
 perl-Text-ParseWords                       noarch               3.30-395.el8                                             baseos                   18 k
 perl-Text-Tabs+Wrap                        noarch               2013.0523-395.el8                                        baseos                   24 k
 perl-Time-Local                            noarch               1:1.280-1.el8                                            baseos                   33 k
 perl-URI                                   noarch               1.73-3.el8                                               appstream               116 k
 perl-Unicode-Normalize                     x86_64               1.25-396.el8                                             baseos                   82 k
 perl-constant                              noarch               1.33-396.el8                                             baseos                   25 k
 perl-interpreter                           x86_64               4:5.26.3-422.el8.0.1                                     baseos                  6.3 M
 perl-libnet                                noarch               3.11-3.el8                                               appstream               121 k
 perl-libs                                  x86_64               4:5.26.3-422.el8.0.1                                     baseos                  1.6 M
 perl-macros                                x86_64               4:5.26.3-422.el8.0.1                                     baseos                   71 k
 perl-parent                                noarch               1:0.237-1.el8                                            baseos                   20 k
 perl-podlators                             noarch               4.11-1.el8                                               baseos                  118 k
 perl-threads                               x86_64               1:2.21-2.el8                                             baseos                   61 k
 perl-threads-shared                        x86_64               1.58-2.el8                                               baseos                   47 k
 policycoreutils-python-utils               noarch               2.9-24.el8                                               baseos                  253 k
 protobuf-lite                              x86_64               3.5.0-15.el8                                             appstream               148 k
 python3-audit                              x86_64               3.0.7-4.el8                                              baseos                   86 k
 python3-libsemanage                        x86_64               2.9-9.el8_6                                              baseos                  127 k
 python3-policycoreutils                    noarch               2.9-24.el8                                               baseos                  2.2 M
 python3-setools                            x86_64               4.3.0-3.el8                                              baseos                  623 k
弱い依存関係のインストール:
 perl-IO-Socket-IP                          noarch               0.39-5.el8                                               appstream                47 k
 perl-IO-Socket-SSL                         noarch               2.066-4.module_el8.6.0+2811+fe6c84b0                     appstream               297 k
 perl-Mozilla-CA                            noarch               20160104-7.module_el8.5.0+2812+ed912d05                  appstream                14 k
モジュールストリームの有効化中:
 mysql                                                           8.0
 perl                                                            5.26
 perl-IO-Socket-SSL                                              2.066
 perl-libwww-perl                                                6.34

トランザクションの概要
========================================================================================================================================================
インストール  55 パッケージ

ダウンロードサイズの合計: 73 M
インストール後のサイズ: 323 M
パッケージのダウンロード:
(1/55): perl-Carp-1.42-396.el8.noarch.rpm                                                                                61 kB/s |  30 kB     00:00
(2/55): perl-Data-Dumper-2.167-399.el8.x86_64.rpm                                                                       909 kB/s |  58 kB     00:00
(3/55): checkpolicy-2.9-1.el8.x86_64.rpm                                                                                470 kB/s | 347 kB     00:00
(4/55): perl-Errno-1.28-422.el8.0.1.x86_64.rpm                                                                          1.7 MB/s |  75 kB     00:00
(5/55): perl-Exporter-5.72-396.el8.noarch.rpm                                                                           1.2 MB/s |  34 kB     00:00
(6/55): perl-File-Path-2.15-2.el8.noarch.rpm                                                                            988 kB/s |  38 kB     00:00
(7/55): perl-Encode-2.97-3.el8.x86_64.rpm                                                                               4.9 MB/s | 1.5 MB     00:00
(8/55): perl-File-Temp-0.230.600-1.el8.noarch.rpm                                                                       1.6 MB/s |  62 kB     00:00
(9/55): perl-Getopt-Long-2.50-4.el8.noarch.rpm                                                                          1.4 MB/s |  63 kB     00:00
(10/55): perl-HTTP-Tiny-0.074-1.el8.noarch.rpm                                                                          1.5 MB/s |  58 kB     00:00
(11/55): perl-IO-1.38-422.el8.0.1.x86_64.rpm                                                                            3.8 MB/s | 141 kB     00:00
(12/55): perl-MIME-Base64-3.15-396.el8.x86_64.rpm                                                                       839 kB/s |  30 kB     00:00
(13/55): perl-PathTools-3.74-1.el8.x86_64.rpm                                                                           2.2 MB/s |  90 kB     00:00
(14/55): perl-Pod-Escapes-1.07-395.el8.noarch.rpm                                                                       529 kB/s |  20 kB     00:00
(15/55): perl-Pod-Perldoc-3.28-396.el8.noarch.rpm                                                                       1.5 MB/s |  86 kB     00:00
(16/55): perl-Pod-Simple-3.35-395.el8.noarch.rpm                                                                        3.7 MB/s | 213 kB     00:00
(17/55): perl-Pod-Usage-1.69-395.el8.noarch.rpm                                                                         849 kB/s |  34 kB     00:00
(18/55): perl-Scalar-List-Utils-1.49-2.el8.x86_64.rpm                                                                   1.5 MB/s |  68 kB     00:00
(19/55): perl-Socket-2.027-3.el8.x86_64.rpm                                                                             1.6 MB/s |  59 kB     00:00
(20/55): perl-Storable-3.11-3.el8.x86_64.rpm                                                                            2.6 MB/s |  98 kB     00:00
(21/55): perl-Term-ANSIColor-4.06-396.el8.noarch.rpm                                                                    1.3 MB/s |  46 kB     00:00
(22/55): perl-Term-Cap-1.17-395.el8.noarch.rpm                                                                          655 kB/s |  23 kB     00:00
(23/55): perl-Text-ParseWords-3.30-395.el8.noarch.rpm                                                                   504 kB/s |  18 kB     00:00
(24/55): perl-Text-Tabs+Wrap-2013.0523-395.el8.noarch.rpm                                                               663 kB/s |  24 kB     00:00
(25/55): perl-Time-Local-1.280-1.el8.noarch.rpm                                                                         597 kB/s |  33 kB     00:00
(26/55): perl-Unicode-Normalize-1.25-396.el8.x86_64.rpm                                                                 1.6 MB/s |  82 kB     00:00
(27/55): perl-constant-1.33-396.el8.noarch.rpm                                                                          1.2 MB/s |  25 kB     00:00
(28/55): libicu-60.3-2.el8_1.x86_64.rpm                                                                                 6.3 MB/s | 8.8 MB     00:01
(29/55): perl-macros-5.26.3-422.el8.0.1.x86_64.rpm                                                                      1.4 MB/s |  71 kB     00:00
(30/55): perl-libs-5.26.3-422.el8.0.1.x86_64.rpm                                                                        8.2 MB/s | 1.6 MB     00:00
(31/55): perl-parent-0.237-1.el8.noarch.rpm                                                                             459 kB/s |  20 kB     00:00
(32/55): perl-podlators-4.11-1.el8.noarch.rpm                                                                           3.2 MB/s | 118 kB     00:00
(33/55): perl-threads-shared-1.58-2.el8.x86_64.rpm                                                                      1.8 MB/s |  47 kB     00:00
(34/55): perl-threads-2.21-2.el8.x86_64.rpm                                                                             1.3 MB/s |  61 kB     00:00
(35/55): policycoreutils-python-utils-2.9-24.el8.noarch.rpm                                                             5.7 MB/s | 253 kB     00:00
(36/55): python3-audit-3.0.7-4.el8.x86_64.rpm                                                                           1.6 MB/s |  86 kB     00:00
(37/55): python3-libsemanage-2.9-9.el8_6.x86_64.rpm                                                                     2.3 MB/s | 127 kB     00:00
(38/55): python3-setools-4.3.0-3.el8.x86_64.rpm                                                                         6.6 MB/s | 623 kB     00:00
(39/55): perl-interpreter-5.26.3-422.el8.0.1.x86_64.rpm                                                                 9.4 MB/s | 6.3 MB     00:00
(40/55): python3-policycoreutils-2.9-24.el8.noarch.rpm                                                                  6.3 MB/s | 2.2 MB     00:00
(41/55): mariadb-connector-c-config-3.1.11-2.el8_3.noarch.rpm                                                            60 kB/s |  14 kB     00:00
(42/55): mysql-common-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64.rpm                                                  1.1 MB/s | 136 kB     00:00
(43/55): mecab-0.996-2.module_el8.6.0+3340+d764b636.x86_64.rpm                                                          2.2 MB/s | 392 kB     00:00
(44/55): mysql-errmsg-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64.rpm                                                  4.3 MB/s | 628 kB     00:00
(45/55): perl-Digest-1.17-395.el8.noarch.rpm                                                                            345 kB/s |  27 kB     00:00
(46/55): perl-Digest-MD5-2.55-396.el8.x86_64.rpm                                                                        599 kB/s |  37 kB     00:00
(47/55): perl-IO-Socket-IP-0.39-5.el8.noarch.rpm                                                                        810 kB/s |  47 kB     00:00
(48/55): perl-IO-Socket-SSL-2.066-4.module_el8.6.0+2811+fe6c84b0.noarch.rpm                                             2.9 MB/s | 297 kB     00:00
(49/55): perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch.rpm                                             275 kB/s |  14 kB     00:00
(50/55): perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64.rpm                                                 3.3 MB/s | 378 kB     00:00
(51/55): perl-URI-1.73-3.el8.noarch.rpm                                                                                 2.3 MB/s | 116 kB     00:00
(52/55): perl-libnet-3.11-3.el8.noarch.rpm                                                                              1.5 MB/s | 121 kB     00:00
(53/55): protobuf-lite-3.5.0-15.el8.x86_64.rpm                                                                          1.4 MB/s | 148 kB     00:00
(54/55): mysql-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64.rpm                                                         6.9 MB/s |  15 MB     00:02
(55/55): mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64.rpm                                                   14 MB/s |  32 MB     00:02
--------------------------------------------------------------------------------------------------------------------------------------------------------
合計                                                                                                                     12 MB/s |  73 MB     00:06
トランザクションの確認を実行中
トランザクションの確認に成功しました。
トランザクションのテストを実行中
トランザクションのテストに成功しました。
トランザクションを実行中
  準備             :                                                                                                                                1/1
  インストール中   : perl-Digest-1.17-395.el8.noarch                                                                                               1/55
  インストール中   : perl-Digest-MD5-2.55-396.el8.x86_64                                                                                           2/55
  インストール中   : perl-Data-Dumper-2.167-399.el8.x86_64                                                                                         3/55
  インストール中   : perl-libnet-3.11-3.el8.noarch                                                                                                 4/55
  インストール中   : perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64                                                                    5/55
  インストール中   : perl-URI-1.73-3.el8.noarch                                                                                                    6/55
  インストール中   : perl-Pod-Escapes-1:1.07-395.el8.noarch                                                                                        7/55
  インストール中   : perl-Time-Local-1:1.280-1.el8.noarch                                                                                          8/55
  インストール中   : perl-IO-Socket-IP-0.39-5.el8.noarch                                                                                           9/55
  インストール中   : perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch                                                               10/55
  インストール中   : perl-IO-Socket-SSL-2.066-4.module_el8.6.0+2811+fe6c84b0.noarch                                                               11/55
  インストール中   : perl-Term-ANSIColor-4.06-396.el8.noarch                                                                                      12/55
  インストール中   : perl-Term-Cap-1.17-395.el8.noarch                                                                                            13/55
  インストール中   : perl-File-Temp-0.230.600-1.el8.noarch                                                                                        14/55
  インストール中   : perl-Pod-Simple-1:3.35-395.el8.noarch                                                                                        15/55
  インストール中   : perl-HTTP-Tiny-0.074-1.el8.noarch                                                                                            16/55
  インストール中   : perl-podlators-4.11-1.el8.noarch                                                                                             17/55
  インストール中   : perl-Pod-Perldoc-3.28-396.el8.noarch                                                                                         18/55
  インストール中   : perl-Text-ParseWords-3.30-395.el8.noarch                                                                                     19/55
  インストール中   : perl-Pod-Usage-4:1.69-395.el8.noarch                                                                                         20/55
  インストール中   : perl-MIME-Base64-3.15-396.el8.x86_64                                                                                         21/55
  インストール中   : perl-Storable-1:3.11-3.el8.x86_64                                                                                            22/55
  インストール中   : perl-Getopt-Long-1:2.50-4.el8.noarch                                                                                         23/55
  インストール中   : perl-Errno-1.28-422.el8.0.1.x86_64                                                                                           24/55
  インストール中   : perl-Socket-4:2.027-3.el8.x86_64                                                                                             25/55
  インストール中   : perl-Encode-4:2.97-3.el8.x86_64                                                                                              26/55
  インストール中   : perl-Exporter-5.72-396.el8.noarch                                                                                            27/55
  インストール中   : perl-Scalar-List-Utils-3:1.49-2.el8.x86_64                                                                                   28/55
  インストール中   : perl-macros-4:5.26.3-422.el8.0.1.x86_64                                                                                      29/55
  インストール中   : perl-parent-1:0.237-1.el8.noarch                                                                                             30/55
  インストール中   : perl-Text-Tabs+Wrap-2013.0523-395.el8.noarch                                                                                 31/55
  インストール中   : perl-Unicode-Normalize-1.25-396.el8.x86_64                                                                                   32/55
  インストール中   : perl-File-Path-2.15-2.el8.noarch                                                                                             33/55
  インストール中   : perl-IO-1.38-422.el8.0.1.x86_64                                                                                              34/55
  インストール中   : perl-PathTools-3.74-1.el8.x86_64                                                                                             35/55
  インストール中   : perl-constant-1.33-396.el8.noarch                                                                                            36/55
  インストール中   : perl-threads-1:2.21-2.el8.x86_64                                                                                             37/55
  インストール中   : perl-threads-shared-1.58-2.el8.x86_64                                                                                        38/55
  インストール中   : perl-libs-4:5.26.3-422.el8.0.1.x86_64                                                                                        39/55
  インストール中   : perl-Carp-1.42-396.el8.noarch                                                                                                40/55
  インストール中   : perl-interpreter-4:5.26.3-422.el8.0.1.x86_64                                                                                 41/55
  インストール中   : mariadb-connector-c-config-3.1.11-2.el8_3.noarch                                                                             42/55
  インストール中   : mysql-common-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    43/55
  インストール中   : mysql-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                           44/55
  インストール中   : mysql-errmsg-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    45/55
  インストール中   : protobuf-lite-3.5.0-15.el8.x86_64                                                                                            46/55
  インストール中   : mecab-0.996-2.module_el8.6.0+3340+d764b636.x86_64                                                                            47/55
  scriptletの実行中: mecab-0.996-2.module_el8.6.0+3340+d764b636.x86_64                                                                            47/55
  インストール中   : python3-setools-4.3.0-3.el8.x86_64                                                                                           48/55
  インストール中   : python3-libsemanage-2.9-9.el8_6.x86_64                                                                                       49/55
  インストール中   : python3-audit-3.0.7-4.el8.x86_64                                                                                             50/55
  インストール中   : libicu-60.3-2.el8_1.x86_64                                                                                                   51/55
  scriptletの実行中: libicu-60.3-2.el8_1.x86_64                                                                                                   51/55
  インストール中   : checkpolicy-2.9-1.el8.x86_64                                                                                                 52/55
  インストール中   : python3-policycoreutils-2.9-24.el8.noarch                                                                                    53/55
  インストール中   : policycoreutils-python-utils-2.9-24.el8.noarch                                                                               54/55
  scriptletの実行中: mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    55/55
  インストール中   : mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    55/55
  scriptletの実行中: mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    55/55
ValueError: /var/log/mysql(/.*)? のファイルコンテキストはすでに定義されています

  検証             : checkpolicy-2.9-1.el8.x86_64                                                                                                  1/55
  検証             : libicu-60.3-2.el8_1.x86_64                                                                                                    2/55
  検証             : perl-Carp-1.42-396.el8.noarch                                                                                                 3/55
  検証             : perl-Data-Dumper-2.167-399.el8.x86_64                                                                                         4/55
  検証             : perl-Encode-4:2.97-3.el8.x86_64                                                                                               5/55
  検証             : perl-Errno-1.28-422.el8.0.1.x86_64                                                                                            6/55
  検証             : perl-Exporter-5.72-396.el8.noarch                                                                                             7/55
  検証             : perl-File-Path-2.15-2.el8.noarch                                                                                              8/55
  検証             : perl-File-Temp-0.230.600-1.el8.noarch                                                                                         9/55
  検証             : perl-Getopt-Long-1:2.50-4.el8.noarch                                                                                         10/55
  検証             : perl-HTTP-Tiny-0.074-1.el8.noarch                                                                                            11/55
  検証             : perl-IO-1.38-422.el8.0.1.x86_64                                                                                              12/55
  検証             : perl-MIME-Base64-3.15-396.el8.x86_64                                                                                         13/55
  検証             : perl-PathTools-3.74-1.el8.x86_64                                                                                             14/55
  検証             : perl-Pod-Escapes-1:1.07-395.el8.noarch                                                                                       15/55
  検証             : perl-Pod-Perldoc-3.28-396.el8.noarch                                                                                         16/55
  検証             : perl-Pod-Simple-1:3.35-395.el8.noarch                                                                                        17/55
  検証             : perl-Pod-Usage-4:1.69-395.el8.noarch                                                                                         18/55
  検証             : perl-Scalar-List-Utils-3:1.49-2.el8.x86_64                                                                                   19/55
  検証             : perl-Socket-4:2.027-3.el8.x86_64                                                                                             20/55
  検証             : perl-Storable-1:3.11-3.el8.x86_64                                                                                            21/55
  検証             : perl-Term-ANSIColor-4.06-396.el8.noarch                                                                                      22/55
  検証             : perl-Term-Cap-1.17-395.el8.noarch                                                                                            23/55
  検証             : perl-Text-ParseWords-3.30-395.el8.noarch                                                                                     24/55
  検証             : perl-Text-Tabs+Wrap-2013.0523-395.el8.noarch                                                                                 25/55
  検証             : perl-Time-Local-1:1.280-1.el8.noarch                                                                                         26/55
  検証             : perl-Unicode-Normalize-1.25-396.el8.x86_64                                                                                   27/55
  検証             : perl-constant-1.33-396.el8.noarch                                                                                            28/55
  検証             : perl-interpreter-4:5.26.3-422.el8.0.1.x86_64                                                                                 29/55
  検証             : perl-libs-4:5.26.3-422.el8.0.1.x86_64                                                                                        30/55
  検証             : perl-macros-4:5.26.3-422.el8.0.1.x86_64                                                                                      31/55
  検証             : perl-parent-1:0.237-1.el8.noarch                                                                                             32/55
  検証             : perl-podlators-4.11-1.el8.noarch                                                                                             33/55
  検証             : perl-threads-1:2.21-2.el8.x86_64                                                                                             34/55
  検証             : perl-threads-shared-1.58-2.el8.x86_64                                                                                        35/55
  検証             : policycoreutils-python-utils-2.9-24.el8.noarch                                                                               36/55
  検証             : python3-audit-3.0.7-4.el8.x86_64                                                                                             37/55
  検証             : python3-libsemanage-2.9-9.el8_6.x86_64                                                                                       38/55
  検証             : python3-policycoreutils-2.9-24.el8.noarch                                                                                    39/55
  検証             : python3-setools-4.3.0-3.el8.x86_64                                                                                           40/55
  検証             : mariadb-connector-c-config-3.1.11-2.el8_3.noarch                                                                             41/55
  検証             : mecab-0.996-2.module_el8.6.0+3340+d764b636.x86_64                                                                            42/55
  検証             : mysql-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                           43/55
  検証             : mysql-common-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    44/55
  検証             : mysql-errmsg-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    45/55
  検証             : mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                                                                    46/55
  検証             : perl-Digest-1.17-395.el8.noarch                                                                                              47/55
  検証             : perl-Digest-MD5-2.55-396.el8.x86_64                                                                                          48/55
  検証             : perl-IO-Socket-IP-0.39-5.el8.noarch                                                                                          49/55
  検証             : perl-IO-Socket-SSL-2.066-4.module_el8.6.0+2811+fe6c84b0.noarch                                                               50/55
  検証             : perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch                                                               51/55
  検証             : perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64                                                                   52/55
  検証             : perl-URI-1.73-3.el8.noarch                                                                                                   53/55
  検証             : perl-libnet-3.11-3.el8.noarch                                                                                                54/55
  検証             : protobuf-lite-3.5.0-15.el8.x86_64                                                                                            55/55

インストール済み:
  checkpolicy-2.9-1.el8.x86_64                                             libicu-60.3-2.el8_1.x86_64
  mariadb-connector-c-config-3.1.11-2.el8_3.noarch                         mecab-0.996-2.module_el8.6.0+3340+d764b636.x86_64
  mysql-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                       mysql-common-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64
  mysql-errmsg-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64                mysql-server-8.0.32-1.module_el8.8.0+3567+56a616e4.x86_64
  perl-Carp-1.42-396.el8.noarch                                            perl-Data-Dumper-2.167-399.el8.x86_64
  perl-Digest-1.17-395.el8.noarch                                          perl-Digest-MD5-2.55-396.el8.x86_64
  perl-Encode-4:2.97-3.el8.x86_64                                          perl-Errno-1.28-422.el8.0.1.x86_64
  perl-Exporter-5.72-396.el8.noarch                                        perl-File-Path-2.15-2.el8.noarch
  perl-File-Temp-0.230.600-1.el8.noarch                                    perl-Getopt-Long-1:2.50-4.el8.noarch
  perl-HTTP-Tiny-0.074-1.el8.noarch                                        perl-IO-1.38-422.el8.0.1.x86_64
  perl-IO-Socket-IP-0.39-5.el8.noarch                                      perl-IO-Socket-SSL-2.066-4.module_el8.6.0+2811+fe6c84b0.noarch
  perl-MIME-Base64-3.15-396.el8.x86_64                                     perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch
  perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64               perl-PathTools-3.74-1.el8.x86_64
  perl-Pod-Escapes-1:1.07-395.el8.noarch                                   perl-Pod-Perldoc-3.28-396.el8.noarch
  perl-Pod-Simple-1:3.35-395.el8.noarch                                    perl-Pod-Usage-4:1.69-395.el8.noarch
  perl-Scalar-List-Utils-3:1.49-2.el8.x86_64                               perl-Socket-4:2.027-3.el8.x86_64
  perl-Storable-1:3.11-3.el8.x86_64                                        perl-Term-ANSIColor-4.06-396.el8.noarch
  perl-Term-Cap-1.17-395.el8.noarch                                        perl-Text-ParseWords-3.30-395.el8.noarch
  perl-Text-Tabs+Wrap-2013.0523-395.el8.noarch                             perl-Time-Local-1:1.280-1.el8.noarch
  perl-URI-1.73-3.el8.noarch                                               perl-Unicode-Normalize-1.25-396.el8.x86_64
  perl-constant-1.33-396.el8.noarch                                        perl-interpreter-4:5.26.3-422.el8.0.1.x86_64
  perl-libnet-3.11-3.el8.noarch                                            perl-libs-4:5.26.3-422.el8.0.1.x86_64
  perl-macros-4:5.26.3-422.el8.0.1.x86_64                                  perl-parent-1:0.237-1.el8.noarch
  perl-podlators-4.11-1.el8.noarch                                         perl-threads-1:2.21-2.el8.x86_64
  perl-threads-shared-1.58-2.el8.x86_64                                    policycoreutils-python-utils-2.9-24.el8.noarch
  protobuf-lite-3.5.0-15.el8.x86_64                                        python3-audit-3.0.7-4.el8.x86_64
  python3-libsemanage-2.9-9.el8_6.x86_64                                   python3-policycoreutils-2.9-24.el8.noarch
  python3-setools-4.3.0-3.el8.x86_64

完了しました!


root# mkdir <code>/APP/mysql</code>
root# chown mysql:mysql /APP/mysql
<code>
:::comment:::
MySQLデータ格納用のディレクトリを準備。
</code>


root# sed -i -e "s#datadir=/var/lib/mysql#<code>datadir=/APP/mysql</code>#" /etc/my.cnf.d/mysql-server.cnf
root# cat <code>/etc/my.cnf.d/mysql-server.cnf</code>
#
# This group are read by MySQL server.
# Use it for options that only the server (but not clients) should see
#
# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/en/server-configuration-defaults.html

# Settings user and group are ignored when systemd is used.
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mysqld according to the
# instructions in http://fedoraproject.org/wiki/Systemd

[mysqld]
<code>datadir=/APP/mysql</code>
socket=/var/lib/mysql/mysql.sock
log-error=/var/log/mysql/mysqld.log
pid-file=/run/mysqld/mysqld.pid
<code>
:::comment:::
データ格納先のデフォルト設定を変更。
</code>


root# systemctl enable mysqld
Created symlink /etc/systemd/system/multi-user.target.wants/mysqld.service → /usr/lib/systemd/system/mysqld.service.
root# systemctl <code>start mysqld</code>
root# systemctl status mysqld
● mysqld.service - MySQL 8.0 database server
   Loaded: loaded (/usr/lib/systemd/system/mysqld.service; enabled; vendor preset: disabled)
   Active: <code>active (running)</code> since Sun 2023-06-11 09:51:28 JST; 7s ago
  Process: 3821 ExecStartPost=/usr/libexec/mysql-check-upgrade (code=exited, status=0/SUCCESS)
  Process: 3700 ExecStartPre=/usr/libexec/mysql-prepare-db-dir mysqld.service (code=exited, status=0/SUCCESS)
  Process: 3676 ExecStartPre=/usr/libexec/mysql-check-socket (code=exited, status=0/SUCCESS)
 Main PID: 3776 (mysqld)
   Status: "Server is operational"
    Tasks: 39 (limit: 12375)
   Memory: 456.0M
   CGroup: /system.slice/mysqld.service
           └─3776 /usr/libexec/mysqld --basedir=/usr

 6月 11 09:51:16 dbserver systemd[1]: Starting MySQL 8.0 database server...
 6月 11 09:51:16 dbserver mysql-prepare-db-dir[3700]: Initializing MySQL database
 6月 11 09:51:28 dbserver systemd[1]: Started MySQL 8.0 database server.
<code>
:::comment::
MySQLが起動する。
</code>

root# mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.32 Source distribution

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> select @@datadir;
+-------------+
| @@datadir   |
+-------------+
| <code>/APP/mysql/</code> |
+-------------+
1 row in set (0.00 sec)
<code>
:::comment:::
データ格納先が/APP/mysqlで認識している。
</code>

mysql> show variables like 'innodb_data_file_path';
+-----------------------+------------------------+
| Variable_name         | Value                  |
+-----------------------+------------------------+
| innodb_data_file_path | <code>ibdata1:12M:autoextend</code> |
+-----------------------+------------------------+
1 row in set (0.00 sec)
<code>
:::comment:::
INNODBで、autoextendになっている。
</code>

mysql> quit
Bye


<h2>データ投入環境（python）の準備</h2>
root# <code>dnf -y install python38</code>
<code>
:::comment:::
python入れてみた。
まぁ、シェルでもperlでもJavaでもなんでもいいんだけど、とりあえずpython。
</code>

メタデータの期限切れの最終確認: 0:32:36 前の 2023年06月11日 09時32分37秒 に実施しました。
依存関係が解決しました。
========================================================================================================================================================
 パッケージ                                アーキテクチャー       バージョン                                            リポジトリー              サイズ
========================================================================================================================================================
インストール:
 python38                                  x86_64                 3.8.16-1.module_el8.8.0+3482+d5d93a3e                 appstream                  79 k
依存関係のインストール:
 python38-libs                             x86_64                 3.8.16-1.module_el8.8.0+3482+d5d93a3e                 appstream                 8.3 M
 python38-pip-wheel                        noarch                 19.3.1-6.module_el8.7.0+3344+99a6a656                 appstream                 1.0 M
 python38-setuptools-wheel                 noarch                 41.6.0-5.module_el8.6.0+2778+cd494b30                 appstream                 303 k
弱い依存関係のインストール:
 python38-pip                              noarch                 19.3.1-6.module_el8.7.0+3344+99a6a656                 appstream                 1.8 M
 python38-setuptools                       noarch                 41.6.0-5.module_el8.6.0+2778+cd494b30                 appstream                 667 k
モジュールストリームの有効化中:
 python38                                                         3.8

トランザクションの概要
========================================================================================================================================================
インストール  6 パッケージ

ダウンロードサイズの合計: 12 M
インストール後のサイズ: 45 M
パッケージのダウンロード:
(1/6): python38-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64.rpm                                                         61 kB/s |  79 kB     00:01
(2/6): python38-pip-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch.rpm                                                    1.3 MB/s | 1.8 MB     00:01
(3/6): python38-setuptools-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch.rpm                                             7.5 MB/s | 667 kB     00:00
(4/6): python38-pip-wheel-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch.rpm                                              5.0 MB/s | 1.0 MB     00:00
(5/6): python38-setuptools-wheel-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch.rpm                                       5.1 MB/s | 303 kB     00:00
(6/6): python38-libs-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64.rpm                                                   4.2 MB/s | 8.3 MB     00:01
--------------------------------------------------------------------------------------------------------------------------------------------------------
合計                                                                                                                    4.1 MB/s |  12 MB     00:02
トランザクションの確認を実行中
トランザクションの確認に成功しました。
トランザクションのテストを実行中
トランザクションのテストに成功しました。
トランザクションを実行中
  準備             :                                                                                                                                1/1
  インストール中   : python38-setuptools-wheel-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch                                                         1/6
  インストール中   : python38-pip-wheel-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch                                                                2/6
  インストール中   : python38-libs-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                                                                     3/6
  インストール中   : python38-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                                                                          4/6
  scriptletの実行中: python38-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                                                                          4/6
  インストール中   : python38-setuptools-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch                                                               5/6
  scriptletの実行中: python38-setuptools-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch                                                               5/6
  インストール中   : python38-pip-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch                                                                      6/6
  scriptletの実行中: python38-pip-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch                                                                      6/6
  検証             : python38-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                                                                          1/6
  検証             : python38-libs-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                                                                     2/6
  検証             : python38-pip-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch                                                                      3/6
  検証             : python38-pip-wheel-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch                                                                4/6
  検証             : python38-setuptools-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch                                                               5/6
  検証             : python38-setuptools-wheel-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch                                                         6/6

インストール済み:
  python38-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64                   python38-libs-3.8.16-1.module_el8.8.0+3482+d5d93a3e.x86_64
  python38-pip-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch               python38-pip-wheel-19.3.1-6.module_el8.7.0+3344+99a6a656.noarch
  python38-setuptools-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch        python38-setuptools-wheel-41.6.0-5.module_el8.6.0+2778+cd494b30.noarch

完了しました!


root# alternatives --config python

3 プログラムがあり 'python' を提供します。

  選択       コマンド
-----------------------------------------------
<code>*+ 1           /usr/libexec/no-python</code>
   2           /usr/bin/python3
   3           /usr/bin/python3.8

Enter を押して現在の選択 [+] を保持するか、選択番号を入力します:<code>3</code>
<code>
:::comment:::
pythonをインストールしても、自動でエリアス認識してくれない。
後々面倒くさいので、デフォルトエリアスをpython3.8が使われるようにする。
</code>

root# alternatives --config python

3 プログラムがあり 'python' を提供します。

  選択       コマンド
-----------------------------------------------
*  1           /usr/libexec/no-python
   2           /usr/bin/python3
<code> + 3           /usr/bin/python3.8</code>

Enter を押して現在の選択 [+] を保持するか、選択番号を入力します:
<code>
:::comment:::
+の位置がpythonコマンドのデフォルトエリアス。
</code>

root# python --version
Python <code>3.8.16</code>
<code>
:::comment:::
python3.8を認識。
</code>

root# <code>update-alternatives --install /usr/bin/pip pip /usr/bin/pip3.8 1</code>
<code>
:::comment:::
pipに関しては、コマンドエリアスのデフォルト値すらないらしい。
無いなら、作ろう。
</code>

root# pip --version
pip <code>19.3.1</code> from /usr/lib/python3.8/site-packages/pip (<code>python 3.8</code>)
<code>
:::comment:::
python3.8インストール時に一緒にインストールされたpipが認識された。
</code>

root# pip install <code>--upgrade pip</code> setuptools
<code>
:::comment:::
pipは最新版にしておかないと、外部にモジュールダウンロードするとき、とにかく怒る。
アップデートします。
</code>

WARNING: Running pip install with root privileges is generally not a good idea. Try `pip install --user` instead.
Collecting pip
  Downloading https://files.pythonhosted.org/packages/08/e3/57d4c24a050aa0bcca46b2920bff40847db79535dc78141eb83581a52eb8/pip-23.1.2-py3-none-any.whl (2.1MB)
     |████████████████████████████████| 2.1MB 11.7MB/s
Collecting setuptools
  Downloading https://files.pythonhosted.org/packages/f5/2c/074ab1c5be9c7d523d8d6d69d1f46f450fe7f11713147dc9e779aa4ca4ea/setuptools-67.8.0-py3-none-any.whl (1.1MB)
     |████████████████████████████████| 1.1MB 8.2MB/s
Installing collected packages: pip, setuptools
Successfully installed pip-23.1.2 setuptools-67.8.0


root# pip install <code>mysql-connector-python</code>
<code>
:::comment:::
大量のレコードを登録したいので、モジュールに頼ります。
mysql-connector-pythonを準備します。
</code>

WARNING: pip is being invoked by an old script wrapper. This will fail in a future version of pip.
Please see https://github.com/pypa/pip/issues/5599 for advice on fixing the underlying issue.
To avoid this problem you can invoke Python with '-m pip' instead of running pip directly.
Collecting mysql-connector-python
  Downloading mysql_connector_python-8.0.33-cp38-cp38-manylinux1_x86_64.whl (27.4 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 27.4/27.4 MB 17.2 MB/s eta 0:00:00
Collecting protobuf<=3.20.3,>=3.11.0 (from mysql-connector-python)
  Downloading protobuf-3.20.3-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.whl (1.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.0/1.0 MB 25.6 MB/s eta 0:00:00
Installing collected packages: protobuf, mysql-connector-python
Successfully installed mysql-connector-python-8.0.33 protobuf-3.20.3


<h2>データベースの作成</h2>
root# vi create.py
<code>
:::comment::
せっかくなので、データベース作るところからpythonでやってみた。
ただの暇つぶしですな。
</code>

root# cat create.py
import mysql.connector

conn = mysql.connector.connect(host='127.0.0.1', user='root', password='')

curs = conn.cursor()
curs.execute('CREATE DATABASE <code>testdb</code>')
curs.close()
conn.close()

conn = mysql.connector.connect(host='127.0.0.1',
                               user='root',
                               password='',
                               database='testdb')

curs = conn.cursor()
curs.execute("""<code>CREATE TABLE testtbl(
                id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,
                name VARCHAR(32) NOT NULL)</code>""")
curs.execute('<code>INSERT INTO testtbl(name) values("AAAAAAAAAAAAAAAAAAAA")</code>')
conn.commit()
curs.close()

conn.close()
<code>
:::comment:::
データベース：testdbを作成、その中にtesttblテーブルを作成し、１件レコードを追加。
ただそれだけのこと。
</code>

root# python create.py

root# mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 11
Server version: 8.0.32 Source distribution

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sys                |
| <code>testdb</code>             |
+--------------------+
5 rows in set (0.00 sec)
<code>
:::comment:::
testdbが作成されている。
</code>

mysql> use testdb;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> show tables;
+------------------+
| Tables_in_testdb |
+------------------+
| <code>testtbl</code>          |
+------------------+
1 row in set (0.00 sec)
<code>
:::comment:::
testtblが作成されている。
</code>

mysql> show create table testtbl \G;
*************************** 1. row ***************************
       <code>Table: testtbl
Create Table: CREATE TABLE `testtbl` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(32) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</code>
1 row in set (0.00 sec)

ERROR:
No query specified
<code>
:::comment:::
テーブル定義も入っている。
</code>

mysql> select * from testtbl;
+----+----------------------+
| id | name                 |
+----+----------------------+
|  <code>1</code> | <code>AAAAAAAAAAAAAAAAAAAA</code> |
+----+----------------------+
1 row in set (0.00 sec)
<code>
:::commment:::
レコードも入っている。
</code>

mysql> quit
Bye


<h2>容量拡張の前にデータをためる</h2>
root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  2.5G   14G   16% /
<code>/dev/sda1                            1014M  237M  778M   24% /boot</code>
/dev/mapper/almalinux_app-APP         495M  220M  275M   45% /APP
tmpfs                                 198M     0  198M    0% /run/user/0
<code>
:::comment:::
初期状態で220MBも使うのね。使用率45%。
</code>

root# du -sh /APP/*
<code>192M	/APP/mysql</code>

root# ls -lh /APP/mysql/testdb
合計 112K
<code>-rw-r----- 1 mysql mysql 112K  6月 11 10:24 testtbl.ibd</code>
<code>
:::comment:::
データファイルは、まぁこんなもの。これから太らせていきます。
</code>


root# vi adddata.py
<code>
:::comment:::
単純にレコードをひたすら追加するコード。
ただそれだけ。
</code>

root# cat adddata.py
import mysql.connector

conn = mysql.connector.connect(host='127.0.0.1',
                               user='root',
                               password='',
                               database='testdb')

curs = conn.cursor()

for i in range(<code>1000000</code>):
	curs.execute('<code>INSERT INTO testtbl(name) values("AAAAAAAAAAAAAAAAAAAA")</code>')
	r = i % 100
	if r == 0:
		conn.commit()
conn.commit()
curs.close()

conn.close()
<code>
:::comment:::
とりあえずAx20の文字列を100万回追加する。
</code>

root# date; <code>python adddata.py</code>; date
2023年  6月 11日 日曜日 10:53:55 JST
2023年  6月 11日 日曜日 10:59:30 JST
<code>
:::comment:::
約4.5分。遅。
まぁ1コアしかリソース振ってないから、致し方なし。
</code>

root# mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 13
Server version: 8.0.32 Source distribution

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use testdb;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> select count(id) from testtbl;
+-----------+
| count(id) |
+-----------+
|   <code>1000001</code> |
+-----------+
1 row in set (0.13 sec)
<code>
:::comment:::
データは全て追加できている。
</code>

mysql> quit
Bye

root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  2.5G   14G   16% /
/dev/sda1                            1014M  237M  778M   24% /boot
/dev/mapper/almalinux_app-APP         <code>495M  396M   99M   81%</code> /APP
tmpfs                                 198M     0  198M    0% /run/user/0

root# du -sh /APP/*
<code>368M</code>	/APP/mysql

root# ls -lh /APP/mysql/testdb
合計 56M
-rw-r----- 1 mysql mysql <code>56M</code>  6月 11 10:59 testtbl.ibd
<code>
:::comment:::
ちょっと太ったかな。思った程ではない。
INNODB自体より、ログとか別ファイルの方が太り方が激しい。
</code>


<h2>ディスクの追加</h2>
root# poweroff
Connection to 192.168.56.2 closed by remote host.
Connection to 192.168.56.2 closed.
<code>
:::comment:::
一旦パワーオフ。
VitualBoxに仮想ディスクを追加して、VMを立ち上げ直す。
</code>

root# fdisk -l
ディスク /dev/sda: 20 GiB, 21474836480 バイト, 41943040 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト
ディスクラベルのタイプ: dos
ディスク識別子: 0x0749b515

デバイス   起動 開始位置 終了位置   セクタ サイズ Id タイプ
/dev/sda1  *        2048  2099199  2097152     1G 83 Linux
/dev/sda2        2099200 39864319 37765120    18G 8e Linux LVM
/dev/sda3       39864320 40896511  1032192   504M 8e Linux LVM

ディスク <code>/dev/sdb: 30 GiB</code>, 32212254720 バイト, 62914560 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト
<code>
:::comment:::
/dev/sdbのディスクが追加された。
</code>

ディスク /dev/mapper/almalinux_dbserver-root: 16 GiB, 17179869184 バイト, 33554432 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

ディスク /dev/mapper/almalinux_dbserver-swap: 2 GiB, 2147483648 バイト, 4194304 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

ディスク /dev/mapper/almalinux_app-APP: 500 MiB, 524288000 バイト, 1024000 セクタ
単位: セクタ (1 * 512 = 512 バイト)
セクタサイズ (論理 / 物理): 512 バイト / 512 バイト
I/O サイズ (最小 / 推奨): 512 バイト / 512 バイト

root# pvs
  PV         VG                 Fmt  Attr PSize   PFree
  /dev/sda2  almalinux_dbserver lvm2 a--   18.00g 4.00m
  /dev/sda3  almalinux_app      lvm2 a--  500.00m    0

root# pvcreate /dev/sdb
  Physical volume "/dev/sdb" successfully created.

root# pvs
  PV         VG                 Fmt  Attr PSize   PFree
  /dev/sda2  almalinux_dbserver lvm2 a--   18.00g  4.00m
  /dev/sda3  almalinux_app      lvm2 a--  500.00m     0
  <code>/dev/sdb                      lvm2 ---   30.00g 30.00g</code>
<code>
:::comment:::
/dev/sdbのPVが追加された。
</code>

root# vgs
  VG                 #PV #LV #SN Attr   VSize   VFree
  almalinux_app        1   1   0 wz--n- 500.00m    0
  almalinux_dbserver   1   2   0 wz--n-  18.00g 4.00m

root# vgextend almalinux_app /dev/sdb
  Volume group "almalinux_app" successfully extended

root# vgs
  VG                 #PV #LV #SN Attr   VSize  VFree
  almalinux_app        2   1   0 wz--n- <code>30.48g <30.00g</code>
  almalinux_dbserver   1   2   0 wz--n- 18.00g   4.00m
<code>
:::comment:::
almalinux_appのVGが30GB拡張された。
</code>

root# lvs
  LV   VG                 Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  APP  almalinux_app      -wi-ao---- <code>500.00m</code>
  root almalinux_dbserver -wi-ao----  16.00g
  swap almalinux_dbserver -wi-ao----   2.00g

root# lvdisplay
  --- Logical volume ---
  LV Path                <code>/dev/almalinux_app/APP</code>
<code>
:::comment:::
LV Pathをメモメモ。
</code>
  LV Name                APP
  VG Name                almalinux_app
  LV UUID                NeXt92-E3GJ-IZgf-bpLj-x9jy-pUY1-Qje9rf
  LV Write Access        read/write
  LV Creation host, time dbserver, 2023-06-10 10:07:04 +0900
  LV Status              available
  # open                 1
  LV Size                500.00 MiB
  Current LE             125
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:2

  --- Logical volume ---
  LV Path                /dev/almalinux_dbserver/swap
  LV Name                swap
  VG Name                almalinux_dbserver
  LV UUID                kZ0gLl-2bpF-VsdC-Bhom-f75N-s9Yf-rqufvP
  LV Write Access        read/write
  LV Creation host, time dbserver, 2023-06-10 10:07:02 +0900
  LV Status              available
  # open                 2
  LV Size                2.00 GiB
  Current LE             512
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:1

  --- Logical volume ---
  LV Path                /dev/almalinux_dbserver/root
  LV Name                root
  VG Name                almalinux_dbserver
  LV UUID                U9U6WE-2qls-ABnn-K6t7-rGFj-P5SV-xEbwxt
  LV Write Access        read/write
  LV Creation host, time dbserver, 2023-06-10 10:07:03 +0900
  LV Status              available
  # open                 1
  LV Size                16.00 GiB
  Current LE             4096
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0

root# lvextend -l +100%FREE /dev/almalinux_app/APP
  Size of logical volume almalinux_app/APP changed from 500.00 MiB (125 extents) to 30.48 GiB (7804 extents).
  Logical volume almalinux_app/APP successfully resized.

root# lvs
  LV   VG                 Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  APP  almalinux_app      -wi-ao---- <code>30.48g</code>
  root almalinux_dbserver -wi-ao---- 16.00g
  swap almalinux_dbserver -wi-ao----  2.00g

root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  2.5G   14G   16% /
/dev/sda1                            1014M  237M  778M   24% /boot
/dev/mapper/almalinux_app-APP         <code>495M  396M   99M   81% /APP</code>
tmpfs                                 198M     0  198M    0% /run/user/0

root# xfs_growfs /APP
meta-data=/dev/mapper/almalinux_app-APP isize=512    agcount=4, agsize=32000 blks
         =                       sectsz=512   attr=2, projid32bit=1
         =                       crc=1        finobt=1, sparse=1, rmapbt=0
         =                       reflink=1    bigtime=0 inobtcount=0
data     =                       bsize=4096   blocks=128000, imaxpct=25
         =                       sunit=0      swidth=0 blks
naming   =version 2              bsize=4096   ascii-ci=0, ftype=1
log      =internal log           bsize=4096   blocks=1368, version=2
         =                       sectsz=512   sunit=0 blks, lazy-count=1
realtime =none                   extsz=4096   blocks=0, rtextents=0
data blocks changed from 128000 to 7991296

root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  2.5G   14G   16% /
/dev/sda1                            1014M  237M  778M   24% /boot
/dev/mapper/almalinux_app-APP          <code>31G  624M   30G    2% /APP</code>
tmpfs                                 198M     0  198M    0% /run/user/0
<code>
:::comment:::
/APPが31GBまで拡張された。
あと何故か使用量が増加している。なぜ？フォーマットの時、なんかオプション必要なのか？
一旦無視。
</code>


<h2>INNODBを太らせる。</h2>
root# vi adddata.py
root# cat adddata.py
import mysql.connector

conn = mysql.connector.connect(host='127.0.0.1',
                               user='root',
                               password='',
                               database='testdb')

curs = conn.cursor()

for i in range(<code>20000000</code>):
	curs.execute('INSERT INTO testtbl(name) values("AAAAAAAAAAAAAAAAAAAA")')
	r = i % 100
	if r == 0:
		conn.commit()
conn.commit()
curs.close()

conn.close()
<code>
:::comment:::
さらに2000万回Ax20の文字列を追加する。
</code>

root# date; python adddata.py; date
2023年  6月 11日 日曜日 11:49:12 JST
2023年  6月 11日 日曜日 13:38:51 JST
<code>
:::comment:::
2時間近くかかっちまった。
まぁ、そんなもんかな。
</code>

root# mysql -u root
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 11
Server version: 8.0.32 Source distribution

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use testdb;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed

mysql> select count(id) from testtbl;
+-----------+
| count(id) |
+-----------+
|  <code>21000001</code> |
+-----------+
1 row in set (3.15 sec)
<code>
:::comment:::
前回より、2000万件のレコードが増えた。
</code>

mysql> quit
Bye

root# df -h
ファイルシス                        サイズ  使用  残り 使用% マウント位置
devtmpfs                              967M     0  967M    0% /dev
tmpfs                                 986M     0  986M    0% /dev/shm
tmpfs                                 986M  8.5M  977M    1% /run
tmpfs                                 986M     0  986M    0% /sys/fs/cgroup
/dev/mapper/almalinux_dbserver-root    16G  2.5G   14G   16% /
/dev/sda1                            1014M  237M  778M   24% /boot
/dev/mapper/almalinux_app-APP          31G  <code>3.9G</code>   27G   13% /APP
tmpfs                                 198M     0  198M    0% /run/user/0
<code>
:::comment:::
使用量が、前回の500MBを超えて、3.9GBまで増加。
拡張領域まで使用している。
</code>

root# du -sh /APP/*
<code>3.6G</code>	/APP/mysql
root# ls -lh /APP/mysql/testdb
合計 961M
-rw-r----- 1 mysql mysql <code>960M</code>  6月 11 13:38 <code>testtbl.ibd</code>
<code>
:::comment:::
対象のINNODBファイルも拡張前の500MBを超えて、順調に太ってきた。
</code>


<h2>検証結果</h2>
<code>
:::comment:::
MySQLのINNODBがautoextend有効の場合、データ保存先のファイルシステム容量を拡張したら、
きちんと拡張分も使用できる。
まぁよく考えたら、MySQLがINNODBファイル領域を起動時に固定的にアロケートしないのであれ
ば、OSのカーネル側がしっかりしていれば問題ないので、想定通りの動きでした。
</code>

</pre>
</body>
</html>
